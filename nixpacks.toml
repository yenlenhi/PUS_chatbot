# Railway Nixpacks configuration
providers = ["python"]

[phases.setup]
nixPkgs = ["python311", "gcc", "postgresql", "coreutils"]

[phases.install]
cmds = [
  "python -m venv /opt/venv",
  ". /opt/venv/bin/activate && pip install --upgrade pip setuptools wheel",
  ". /opt/venv/bin/activate && pip install -r requirements.txt",
  "python -c \"import os; [os.makedirs(d, exist_ok=True) for d in ['/app/data/pdfs', '/app/data/processed', '/app/data/embeddings', '/app/logs']]\""
]

[start]
cmd = "cd /app && PYTHONPATH=/app /opt/venv/bin/python -m uvicorn main:app --host 0.0.0.0 --port ${PORT:-8000}"

[variables]
NIXPACKS_PYTHON_VERSION = "3.11"
PATH = "/opt/venv/bin:$PATH"
PYTHONPATH = "/app"
PDF_WATCH_DIR = "/app/data/pdfs"
PROCESSED_PDF_DIR = "/app/data/processed"
DATABASE_PATH = "/app/data/embeddings/chatbot.db"
FAISS_INDEX_PATH = "/app/data/embeddings/faiss_index"
LOG_FILE = "/app/logs/chatbot.log"
